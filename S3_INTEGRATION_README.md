# S3 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

## –û–±–∑–æ—Ä

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–æ —Å S3-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Ä—É–ª–µ—Ç–æ–∫. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–µ—Ä–≤–∏—Å TWC Storage.

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### S3 Credentials
- **Endpoint**: https://s3.twcstorage.ru
- **Bucket**: 617774af-gifty
- **Region**: ru-1
- **Access Key**: I6XD2OR7YO2ZN6L6Z629
- **Secret Key**: 9xCOoafisG0aB9lJNvdLO1UuK73fBvMcpHMdijrJ

### Swift (–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª)
- **URL**: https://swift.twcstorage.ru
- **Access Key**: wu14330:swift
- **Secret Key**: Zh6NYPbgp4IYmzKeMAUgwZFi8uLY4VpS6SIYMDge

## –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞

```
src/
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îî‚îÄ‚îÄ s3.ts                    # S3 –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ —É—Ç–∏–ª–∏—Ç—ã
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ upload-image/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ route.ts         # API endpoint –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ test-s3-upload/
‚îÇ       ‚îî‚îÄ‚îÄ page.tsx             # –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îî‚îÄ‚îÄ components/
    ‚îî‚îÄ‚îÄ ImageUpload.tsx          # –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
```

## API Endpoints

### POST /api/upload-image

–ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ S3 —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `image` (File) - –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏

**–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:**
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 5 MB
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: JPG, PNG, GIF, WebP

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "url": "https://s3.twcstorage.ru/617774af-gifty/wheel-images/1640995200000-abc123.jpg",
  "fileName": "wheel-images/1640995200000-abc123.jpg",
  "originalName": "my-image.jpg",
  "size": 102400,
  "type": "image/jpeg"
}
```

## –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### ImageUpload

–ö–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å drag & drop –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π.

```tsx
import ImageUpload from '@/components/ImageUpload';

<ImageUpload
  onImageSelect={(imageUrl) => console.log('–ó–∞–≥—Ä—É–∂–µ–Ω–æ:', imageUrl)}
  currentImage={currentImageUrl}
  disabled={false}
/>
```

**Props:**
- `onImageSelect: (imageUrl: string) => void` - callback –ø—Ä–∏ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
- `currentImage?: string` - —Ç–µ–∫—É—â–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
- `disabled?: boolean` - –æ—Ç–∫–ª—é—á–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É

## –£—Ç–∏–ª–∏—Ç—ã

### src/lib/s3.ts

–û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å S3:

- `uploadToS3(file, fileName, contentType)` - –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–∞
- `deleteFromS3(fileName)` - —É–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
- `getSignedDownloadUrl(fileName, expiresIn)` - –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω–æ–π —Å—Å—ã–ª–∫–∏
- `generateUniqueFileName(originalName, prefix)` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –∏–º–µ–Ω–∏
- `isImageFile(contentType)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
- `isValidFileSize(fileSize, maxSizeInMB)` - –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ —Ä—É–ª–µ—Ç–∫–∞—Ö

### –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–µ–≥–º–µ–Ω—Ç–æ–≤ (PRO)
PRO –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è —Å–µ–≥–º–µ–Ω—Ç–æ–≤ —Ä—É–ª–µ—Ç–∫–∏ –≤–º–µ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ü–≤–µ—Ç–æ–≤.

### –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (PRO)
PRO –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞ —Ä—É–ª–µ—Ç–∫–∏.

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ `/test-s3-upload` –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:

1. **–ó–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç** - —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç ImageUpload –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
2. **–ü—Ä—è–º–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ API** - —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç API endpoint –Ω–∞–ø—Ä—è–º—É—é

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í—Å–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞ —Ç–∏–ø (—Ç–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤ (5 MB)
- –ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
- –§–∞–π–ª—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å –ø—É–±–ª–∏—á–Ω—ã–º –¥–æ—Å—Ç—É–ø–æ–º –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —Ä—É–ª–µ—Ç–∫–∞—Ö

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è

–§–∞–π–ª—ã –≤ S3 –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω—ã –ø–æ –ø–∞–ø–∫–∞–º:

```
617774af-gifty/
‚îî‚îÄ‚îÄ wheel-images/
    ‚îú‚îÄ‚îÄ 1640995200000-abc123.jpg    # –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–µ–≥–º–µ–Ω—Ç–æ–≤
    ‚îú‚îÄ‚îÄ 1640995201000-def456.png    # –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    ‚îî‚îÄ‚îÄ ...
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å S3 –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å:
- ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ –∑–∞–≥—Ä—É–∑–∫–∏
- ‚ùå –û—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏
- üîç –î–µ—Ç–∞–ª–∏ —Ñ–∞–π–ª–æ–≤ (—Ä–∞–∑–º–µ—Ä, —Ç–∏–ø, –∏–º—è)

## Troubleshooting

### –û—à–∏–±–∫–∞ "–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª"
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Ñ–∞–π–ª —è–≤–ª—è–µ—Ç—Å—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ (–Ω–µ –±–æ–ª–µ–µ 5 MB)

### –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ S3 bucket –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ —á—Ç–µ–Ω–∏—è
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ bucket

### –ú–µ–¥–ª–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
1. –£–º–µ–Ω—å—à–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã (WebP, –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JPEG) 